<script>
    // Questo script crea e inietta l'intera pagina web in un blocco di Google Sites.
    document.addEventListener('DOMContentLoaded', () => {

        // Aggiunge gli stili CSS personalizzati e i link ai font
        const styleSheet = `
            html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            body {
                font-family: 'Inter', sans-serif;
                background-color: #1a232e;
                background-image: radial-gradient(circle, #2b3a4a 0.5px, transparent 0.5px);
                background-position: 0 0;
                background-size: 20px 20px;
                background-attachment: fixed;
                color: #fff;
            }
            .video-container {
                position: relative;
                padding-bottom: 56.25%; /* Rapporto 16:9 */
                height: 0;
                overflow: hidden;
                border-radius: 0.5rem;
            }
            .video-container iframe {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }
            .channel-info {
                background-size: cover;
                background-position: center;
            }
            .shimmer-bg {
                background: linear-gradient(to right, #2b3a4a 8%, #415a77 18%, #2b3a4a 33%);
                background-size: 200% 100%;
                animation: shimmer 1.5s infinite linear;
            }
            @keyframes shimmer {
                0% { background-position: -200% 0; }
                100% { background-position: 200% 0; }
            }
        `;

        // Struttura HTML dell'intera pagina
        const pageHtml = `
            <!-- Header -->
            <header class="p-6 text-center">
                <h1 id="channel-title" class="text-4xl font-extrabold text-blue-400 shimmer-bg w-1/2 mx-auto h-12 rounded-lg"></h1>
                <p class="text-xl text-slate-300 mt-2">I tuoi video, la tua community, il tuo spazio!</p>
            </header>

            <!-- Sezione Informazioni Canale -->
            <section id="channel-info" class="p-8 rounded-lg shadow-xl m-4 md:m-8 text-center channel-info">
                <div class="bg-black bg-opacity-50 p-6 rounded-lg backdrop-blur-sm">
                    <h2 class="text-3xl font-bold text-white mb-4">Benvenuto!</h2>
                    <div id="profile-pic-container" class="mx-auto rounded-full w-28 h-28 shimmer-bg mb-4 border-4 border-blue-400 shadow-lg"></div>
                    <p id="channel-description" class="text-lg text-slate-200">
                        Qui puoi trovare tutti i miei video e richiedere le tue basi personalizzate!
                    </p>
                    <a id="channel-link" href="#" target="_blank" class="mt-6 inline-block bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-300 transform hover:scale-105 shadow-lg">
                        Visita il Canale YouTube
                    </a>
                </div>
            </section>

            <!-- Player Video Principale -->
            <section class="container mx-auto p-4 md:p-8">
                <div id="main-video-player" class="video-container bg-slate-800 rounded-xl shadow-lg transform transition-transform duration-300 mb-8 hidden">
                    <!-- Il video principale verrà caricato qui -->
                </div>
                <div id="player-placeholder" class="bg-slate-800 p-8 rounded-xl shadow-lg text-center text-slate-400">
                    Seleziona un video qui sotto per iniziare a guardare.
                </div>
            </section>

            <!-- Video Recenti -->
            <section class="container mx-auto p-4 md:p-8">
                <h2 class="text-3xl font-bold text-center text-blue-400 mb-8">Ultimi Video</h2>
                <div id="video-gallery" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="shimmer-bg p-4 rounded-xl shadow-lg h-64"></div>
                    <div class="shimmer-bg p-4 rounded-xl shadow-lg h-64 hidden sm:block"></div>
                    <div class="shimmer-bg p-4 rounded-xl shadow-lg h-64 hidden lg:block"></div>
                </div>
                <div id="error-message" class="text-center text-red-500 mt-8 hidden">
                    Si è verificato un errore durante il recupero dei video. Riprova più tardi.
                </div>
            </section>
            
            <!-- Form Richiesta Basi Personalizzate -->
            <section class="container mx-auto p-4 md:p-8">
                <h2 class="text-3xl font-bold text-center text-blue-400 mb-8">Richiedi una Base Personalizzata</h2>
                <div class="bg-slate-800 p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
                    <p class="text-slate-300 mb-6 text-center">Compila il modulo e ti contatterò per la tua base personalizzata!</p>
                    <form  action="https://formspree.io/f/mwpqapvp"  method="POST">
                        <div class="mb-4">
                            <label class="block text-slate-400 mb-2">Il tuo nome</label>
                            <input type="text" name="Nome" class="w-full px-4 py-2 bg-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-slate-400 mb-2">La tua email</label>
                            <input type="email" name="Email" class="w-full px-4 py-2 bg-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-slate-400 mb-2">Dettagli della richiesta (brano, artista, ecc.)</label>
                            <textarea name="Dettagli Richiesta" rows="4" class="w-full px-4 py-2 bg-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-400" required></textarea>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 transform hover:scale-105 shadow-lg">
                            Invia Richiesta
                        </button>
                    </form>
                </div>
            </section>

            <!-- Sezione "Offrimi un Caffè" -->
            <section class="container mx-auto p-4 md:p-8 text-center">
                <h2 class="text-3xl font-bold text-blue-400 mb-4">Supporta il Canale</h2>
                <p class="text-slate-300 mb-6 max-w-xl mx-auto">Se ti piace il mio lavoro e vuoi supportarmi, puoi offrirmi un caffè! Il tuo supporto mi aiuta a creare nuovi contenuti.</p>
                <a href="https://buymeacoffee.com/karaokeitaliano" target="_blank" class="inline-block bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-3 px-8 rounded-full transition-colors duration-300 transform hover:scale-105 shadow-lg">
                    Offrimi un Caffè!
                </a>
            </section>

            <!-- Footer -->
            <footer class="bg-slate-800 text-center p-6 mt-8 rounded-t-xl shadow-inner">
                <p class="text-slate-400">&copy; 2025 Il Mio Canale YouTube. Tutti i diritti riservati.</p>
                <p class="text-slate-500 mt-2">
                    Seguimi anche su: 
                    <a href="#" class="text-blue-400 hover:underline">Instagram</a> | 
                    <a href="#" class="text-blue-400 hover:underline">Twitter</a>
                </p>
            </footer>
        `;

        // Funzione principale che esegue tutta la logica
        function initApp() {
            const apiKey = 'AIzaSyAx2p2Rj209WL8LcP48QckuGeZwY7xpTGU'; 
            const channelId = 'UC09bE-qRBo72IIQ54Xaf-EA';
            const videoGallery = document.getElementById('video-gallery');
            const errorMessage = document.getElementById('error-message');
            const channelLink = document.getElementById('channel-link');
            const channelTitle = document.getElementById('channel-title');
            const channelInfoSection = document.getElementById('channel-info');
            const profilePicContainer = document.getElementById('profile-pic-container');
            const channelDescription = document.getElementById('channel-description');
            const mainVideoPlayer = document.getElementById('main-video-player');
            const playerPlaceholder = document.getElementById('player-placeholder');

            const fetchChannelInfo = async () => {
                const url = 'https://www.googleapis.com/youtube/v3/channels?id=' + channelId + '&key=' + apiKey + '&part=snippet,brandingSettings,contentDetails';
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error('HTTP error! status: ' + response.status);
                    }
                    const data = await response.json();
                    
                    const channelName = data.items[0].snippet.title;
                    const profilePicUrl = data.items[0].snippet.thumbnails.high.url;
                    const bannerUrl = data.items[0].brandingSettings.image.bannerImageUrl;
                    const descriptionText = 'Qui puoi trovare tutti i miei video e richiedere le tue basi personalizzate!';
                    
                    channelTitle.textContent = channelName;
                    channelTitle.classList.remove('shimmer-bg', 'w-1/2', 'h-12');
                    
                    const profilePic = document.createElement('img');
                    profilePic.src = profilePicUrl;
                    profilePic.alt = 'Profile Picture';
                    profilePic.className = 'rounded-full w-28 h-28 mx-auto mb-4 border-4 border-blue-400 shadow-lg';
                    profilePicContainer.innerHTML = '';
                    profilePicContainer.appendChild(profilePic);
                    profilePicContainer.classList.remove('shimmer-bg');
                    
                    channelInfoSection.style.backgroundImage = 'url(' + bannerUrl + ')';
                    channelDescription.textContent = descriptionText;
                    channelLink.href = 'https://www.youtube.com/channel/' + channelId;
                    
                    return data.items[0].contentDetails.relatedPlaylists.uploads;
                } catch (error) {
                    console.error("Errore nel recupero delle informazioni del canale:", error);
                    errorMessage.classList.remove('hidden');
                    return null;
                }
            };

            const fetchVideos = async (uploadsPlaylistId) => {
                if (!uploadsPlaylistId) {
                    videoGallery.innerHTML = '';
                    return;
                }
                
                const maxResults = 6;
                const uploadsUrl = 'https://www.googleapis.com/youtube/v3/playlistItems?playlistId=' + uploadsPlaylistId + '&key=' + apiKey + '&part=snippet&maxResults=' + maxResults;
                
                try {
                    const videosResponse = await fetch(uploadsUrl);
                    if (!videosResponse.ok) {
                        throw new Error('HTTP error! status: ' + videosResponse.status);
                    }
                    const videosData = await videosResponse.json();

                    videoGallery.innerHTML = '';
                    if (videosData.items.length === 0) {
                        videoGallery.innerHTML = '<p class="text-center text-slate-400 col-span-full">Nessun video trovato nel canale.</p>';
                    } else {
                        const firstVideoId = videosData.items[0].snippet.resourceId.videoId;
                        loadMainVideo(firstVideoId);

                        videosData.items.forEach(item => {
                            const videoId = item.snippet.resourceId.videoId;
                            const title = item.snippet.title;
                            const thumbnailUrl = item.snippet.thumbnails.medium.url;

                            const videoCard = 
                                '<div class="bg-slate-800 p-4 rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-300 cursor-pointer video-card" data-video-id="' + videoId + '">' +
                                    '<img src="' + thumbnailUrl + '" alt="' + title + '" class="rounded-lg mb-4 w-full">' +
                                    '<h3 class="text-xl font-semibold text-slate-100">' + title + '</h3>' +
                                '</div>';
                            videoGallery.innerHTML += videoCard;
                        });
                        
                        document.querySelectorAll('.video-card').forEach(card => {
                            card.addEventListener('click', (e) => {
                                const videoId = e.currentTarget.dataset.videoId;
                                loadMainVideo(videoId);
                            });
                        });
                    }
                } catch (error) {
                    console.error("Errore nel recupero dei video:", error);
                    errorMessage.classList.remove('hidden');
                    videoGallery.innerHTML = '';
                }
            };

            const loadMainVideo = (videoId) => {
                playerPlaceholder.classList.add('hidden');
                mainVideoPlayer.classList.remove('hidden');
                mainVideoPlayer.innerHTML = 
                    '<iframe src="https://www.youtube.com/embed/' + videoId + '" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
            }
            
            const init = async () => {
                const uploadsPlaylistId = await fetchChannelInfo();
                if (uploadsPlaylistId) {
                    fetchVideos(uploadsPlaylistId);
                }
            };
            
            init();
        }

        // Inietta l'HTML e il CSS nel documento
        const container = document.createElement('div');
        container.innerHTML = pageHtml;
        document.body.appendChild(container);

        const styleElement = document.createElement('style');
        styleElement.textContent = styleSheet;
        document.head.appendChild(styleElement);

        const tailwindScript = document.createElement('script');
        tailwindScript.src = 'https://cdn.tailwindcss.com';
        document.head.appendChild(tailwindScript);

        const interFont = document.createElement('link');
        interFont.rel = 'stylesheet';
        interFont.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap';
        document.head.appendChild(interFont);
        
        // Esegui la funzione principale dopo aver iniettato il contenuto
        initApp();

    });
</script>
